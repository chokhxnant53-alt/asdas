<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô | Flash Express</title>
  <link rel="icon" href="https://flashexpress.com/favicon.ico" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: "Prompt", sans-serif;
      background-color: #fffbea;
      margin: 0;
      padding: 0;
    }

    header {
      background: #ffeb3b;
      text-align: center;
      padding: 18px;
      font-weight: bold;
      font-size: 22px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .container {
      padding: 20px;
      width: 90%;
      max-width: 1200px;
      margin: 25px auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }

    h3 {
      text-align: center;
      color: #5e35b1;
      font-size: 20px;
      margin-top: 30px;
    }

    input[type="text"] {
      display: block;
      width: 90%;
      max-width: 450px;
      margin: 15px auto 30px;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      text-align: center;
      font-size: 15px;
      transition: 0.2s;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: #ffeb3b;
      box-shadow: 0 0 5px #ffeb3b80;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 25px;
      overflow-x: auto;
      display: block;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
      font-size: 14px;
      white-space: nowrap;
    }

    th {
      background: #ffeb3b;
      font-weight: bold;
    }

    button {
      border: none;
      border-radius: 6px;
      padding: 7px 12px;
      cursor: pointer;
      font-weight: bold;
      font-size: 13px;
      transition: 0.2s;
    }

    .btn-green { background: #4CAF50; color: white; }
    .btn-green:hover { background: #43a047; }
    .btn-red   { background: #f44336; color: white; }
    .btn-red:hover { background: #e53935; }
    .btn-blue  { background: #2196F3; color: white; }
    .btn-blue:hover { background: #1e88e5; }

    .logout {
      display: block;
      margin: 25px auto 10px;
      background: #ff5252;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 25px;
      font-weight: bold;
      font-size: 15px;
      cursor: pointer;
      transition: 0.2s;
    }

    .logout:hover { background: #e53935; }

    @media (max-width: 600px) {
      th, td { font-size: 12px; padding: 6px; }
      input[type="text"] { width: 95%; }
      h3 { font-size: 18px; }
    }
  </style>
</head>
<body>

  <header>üë®‚Äçüíº ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</header>

  <div class="container">
    <h3>üì± ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>

    <!-- üîç ‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠ -->
    <input type="text" id="searchInput" placeholder="üîç ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...">

    <!-- üìã ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ -->
    <table id="customerTable">
      <thead>
        <tr>
          <th>#</th>
          <th>‡∏ä‡∏∑‡πà‡∏≠ / ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£<br><small>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</small></th>
          <th>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
          <th>‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th>
          <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°</th>
          <th colspan="3">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h3>üì¶ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡πà‡∏ô‡πÄ‡∏Ñ‡∏•‡∏°‡∏û‡∏±‡∏™‡∏î‡∏∏</h3>
    <table id="claimTable">
      <thead>
        <tr>
          <th>‡∏ä‡∏∑‡πà‡∏≠</th>
          <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
          <th>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</th>
          <th>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</th>
          <th>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</th>
          <th>‡∏¢‡∏≠‡∏î‡πÄ‡∏Ñ‡∏•‡∏°</th>
          <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
          <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <button class="logout" onclick="logout()">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
  </div>

  <script>
    // üîí ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
    if (sessionStorage.getItem("isAdminLoggedIn") !== "true") {
      alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô");
      window.location.href = "admin-login.html";
    }

    // ‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    const balances = JSON.parse(localStorage.getItem("customer_balances")) || {};
    const customerTable = document.querySelector("#customerTable tbody");

    function renderCustomers(filter = "") {
      customerTable.innerHTML = "";

      const customerData = JSON.parse(localStorage.getItem("customer_data")) || {};
      const allPhones = [...new Set([...Object.keys(customerData), ...Object.keys(balances)])];

      const customers = allPhones.filter(phone => {
        const info = customerData[phone];
        const name = info?.name?.toLowerCase() || "";
        return phone.includes(filter) || name.includes(filter.toLowerCase());
      });

      if (customers.length === 0) {
        customerTable.innerHTML = `<tr><td colspan="8">‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</td></tr>`;
        return;
      }

      customers.forEach((phone, index) => {
        const info = customerData[phone] || {};
        const name = info.name || "(‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠)";
        const createdAt = info.createdAt || "-";
        const tx = JSON.parse(localStorage.getItem(`transactions_${phone}`)) || [];
        const latest = tx[0] ? `${tx[0].type} ${tx[0].amount}‡∏ø (${tx[0].status})` : "-";
        const txCount = tx.length;

        customerTable.innerHTML += `
          <tr>
            <td>${index + 1}</td>
            <td><b>${name}</b><br>${phone}<br><small>${createdAt}</small></td>
            <td>${(balances[phone] || 0).toLocaleString("th-TH", { minimumFractionDigits: 2 })}</td>
            <td>${latest}</td>
            <td>${txCount}</td>
            <td><button class="btn-green" onclick="topUp('${phone}')">+ ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</button></td>
            <td><button class="btn-red" onclick="withdraw('${phone}')">- ‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</button></td>
            <td><button class="btn-blue" onclick="viewTransactions('${phone}')">‡∏î‡∏π‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°</button></td>
          </tr>`;
      });
    }

    renderCustomers();

    // üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå
    document.getElementById("searchInput").addEventListener("input", e => renderCustomers(e.target.value.trim()));

    // üí∞ ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô
    function topUp(phone) {
      const amount = parseFloat(prompt(`üí∏ ‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏ö‡∏≠‡∏£‡πå ${phone}:`));
      if (isNaN(amount) || amount <= 0) return alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");

      const balances = JSON.parse(localStorage.getItem("customer_balances")) || {};
      balances[phone] = (balances[phone] || 0) + amount;
      localStorage.setItem("customer_balances", JSON.stringify(balances));
      addTransaction(phone, "‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô", amount, "‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      alert(`‚úÖ ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏ö‡∏≠‡∏£‡πå ${phone} ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${amount.toFixed(2)} ‡∏ö‡∏≤‡∏ó‡πÅ‡∏•‡πâ‡∏ß`);
      renderCustomers();
    }

    // üí∏ ‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô
    function withdraw(phone) {
      const amount = parseFloat(prompt(`üí∞ ‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå ${phone}:`));
      const balances = JSON.parse(localStorage.getItem("customer_balances")) || {};
      if (isNaN(amount) || amount <= 0) return alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
      if (!balances[phone] || balances[phone] < amount) return alert("‚ùå ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠");

      balances[phone] -= amount;
      localStorage.setItem("customer_balances", JSON.stringify(balances));
      addTransaction(phone, "‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô", amount, "‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      alert(`üí∏ ‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå ${phone} ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${amount.toFixed(2)} ‡∏ö‡∏≤‡∏ó‡πÅ‡∏•‡πâ‡∏ß`);
      renderCustomers();
    }

    // üìú ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°
    function addTransaction(phone, type, amount, status) {
      const key = `transactions_${phone}`;
      const list = JSON.parse(localStorage.getItem(key)) || [];
      list.unshift({ date: new Date().toLocaleString("th-TH"), type, amount, status });
      localStorage.setItem(key, JSON.stringify(list));
    }

    // üëÅ ‡∏î‡∏π‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°
    function viewTransactions(phone) {
      const tx = JSON.parse(localStorage.getItem(`transactions_${phone}`)) || [];
      if (!tx.length) return alert(`üìû ‡πÄ‡∏ö‡∏≠‡∏£‡πå ${phone}\n‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö`);
      alert(tx.map(t => `‚Ä¢ ${t.date}\n${t.type} ${t.amount}‡∏ø - ${t.status}`).join("\n\n"));
    }

    // ‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏°
    const claimTable = document.querySelector("#claimTable tbody");
    const claims = JSON.parse(localStorage.getItem("claim_requests")) || [];

    if (!claims.length) {
      claimTable.innerHTML = `<tr><td colspan="8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏°</td></tr>`;
    } else {
      claims.forEach((c, i) => {
        claimTable.innerHTML += `
          <tr>
            <td>${c.name}</td>
            <td>${c.date}</td>
            <td>${c.phone}</td>
            <td>${c.bank}</td>
            <td>${c.account}</td>
            <td>${c.amount}</td>
            <td id="status-${i}" style="color:${c.status === "‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥" ? "green" : c.status === "‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò" ? "red" : "black"};">${c.status}</td>
            <td>
              <button class="btn-green" onclick="approveClaim(${i})">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
              <button class="btn-red" onclick="rejectClaim(${i})">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
            </td>
          </tr>`;
      });
    }

    function approveClaim(i) {
      const claims = JSON.parse(localStorage.getItem("claim_requests")) || [];
      claims[i].status = "‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥";
      localStorage.setItem("claim_requests", JSON.stringify(claims));
      document.getElementById(`status-${i}`).textContent = "‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥";
      document.getElementById(`status-${i}`).style.color = "green";
      alert("‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
    }

    function rejectClaim(i) {
      const claims = JSON.parse(localStorage.getItem("claim_requests")) || [];
      claims[i].status = "‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò";
      localStorage.setItem("claim_requests", JSON.stringify(claims));
      document.getElementById(`status-${i}`).textContent = "‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò";
      document.getElementById(`status-${i}`).style.color = "red";
      alert("‚ùå ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß");
    }

    // üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
    function logout() {
      sessionStorage.removeItem("isAdminLoggedIn");
      alert("‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
      window.location.href = "admin-login.html";
    }

    // üïí ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏á‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ 5 ‡∏ß‡∏±‡∏ô
    const RESET_KEY = "system_reset_time";
    const NOW = Date.now();
    const FIVE_DAYS = 5 * 24 * 60 * 60 * 1000;
    const lastReset = localStorage.getItem(RESET_KEY);

    if (!lastReset) {
      localStorage.setItem(RESET_KEY, NOW);
    } else if (NOW - parseInt(lastReset) > FIVE_DAYS) {
      localStorage.clear();
      localStorage.setItem(RESET_KEY, NOW);
      alert("‚è≥ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö 5 ‡∏ß‡∏±‡∏ô ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß");
      location.reload();
    }
  </script>
</body>
</html>
