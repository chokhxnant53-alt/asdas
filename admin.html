<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô | Flash Express</title>
  <link rel="icon" href="https://flashexpress.com/favicon.ico" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: "Prompt", sans-serif;
      background-color: #fffbea;
      margin: 0;
      padding: 0;
    }

    header {
      background: #ffeb3b;
      text-align: center;
      padding: 18px;
      font-weight: bold;
      font-size: 22px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .container {
      padding: 20px;
      width: 90%;
      max-width: 1200px;
      margin: 25px auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 25px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
      font-size: 14px;
    }

    th {
      background: #ffeb3b;
      font-weight: bold;
    }

    button {
      border: none;
      border-radius: 6px;
      padding: 7px 12px;
      cursor: pointer;
      font-weight: bold;
      font-size: 13px;
      transition: 0.2s;
    }

    .btn-green { background: #4CAF50; color: white; }
    .btn-red   { background: #f44336; color: white; }
    .btn-blue  { background: #2196F3; color: white; }
    .btn-green:hover { background: #43a047; }
    .btn-red:hover   { background: #e53935; }
    .btn-blue:hover  { background: #1e88e5; }

    .logout {
      display: block;
      margin: 25px auto;
      background: #ff5252;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 25px;
      font-weight: bold;
      font-size: 15px;
      cursor: pointer;
      transition: 0.2s;
    }
    .logout:hover { background: #e53935; }
  </style>
</head>
<body>

  <header>üë®‚Äçüíº ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</header>

  <div class="container">
    <h3>üì± ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
    <table id="customerTable">
      <thead>
        <tr>
          <th>#</th>
          <th>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</th>
          <th>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
          <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</th>
          <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
        </tr>
      </thead>
      <tbody id="customerList"></tbody>
    </table>

    <h3>üì¶ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡πà‡∏ô‡πÄ‡∏Ñ‡∏•‡∏°</h3>
    <table id="claimTable">
      <thead>
        <tr>
          <th>‡∏ä‡∏∑‡πà‡∏≠</th>
          <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
          <th>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</th>
          <th>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</th>
          <th>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</th>
          <th>‡∏¢‡∏≠‡∏î‡πÄ‡∏Ñ‡∏•‡∏°</th>
          <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
          <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
        </tr>
      </thead>
      <tbody id="claimList"></tbody>
    </table>

    <button class="logout" onclick="logout()">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
  </div>

  <!-- ‚úÖ Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js"></script>

  <script>
    // ‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyALSOECmTwrVr0RQAp_b632HmxQ0sJvLMw",
      authDomain: "flash-claim-system.firebaseapp.com",
      databaseURL: "https://flash-claim-system-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "flash-claim-system",
      storageBucket: "flash-claim-system.firebasestorage.app",
      messagingSenderId: "369180040049",
      appId: "1:369180040049:web:6753f5e48a23bc6737b4d0",
      measurementId: "G-VLVBY60G3Q"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.database();

    // ‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å Firebase
    const customerList = document.getElementById("customerList");
    const customerRef = db.ref("customers");

    customerRef.on("value", snapshot => {
      const data = snapshot.val() || {};
      customerList.innerHTML = "";

      let index = 1;
      for (const phone in data) {
        const c = data[phone];
        customerList.innerHTML += `
          <tr>
            <td>${index++}</td>
            <td>${c.phone}</td>
            <td>${parseFloat(c.balance || 0).toLocaleString("th-TH", {minimumFractionDigits:2})}</td>
            <td>${c.createdAt || "-"}</td>
            <td>
              <button class="btn-green" onclick="topUp('${c.phone}')">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</button>
              <button class="btn-red" onclick="withdraw('${c.phone}')">‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</button>
            </td>
          </tr>
        `;
      }
    });

    // ‚úÖ ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô
    function topUp(phone) {
      const amount = parseFloat(prompt(`üí∏ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏´‡πâ ${phone}`));
      if (isNaN(amount) || amount <= 0) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");

      const ref = db.ref("customers/" + phone + "/balance");
      ref.transaction(current => (current || 0) + amount);
      alert(`‚úÖ ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ ${phone} ${amount.toFixed(2)} ‡∏ö‡∏≤‡∏ó‡πÅ‡∏•‡πâ‡∏ß`);
    }

    // ‚úÖ ‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô
    function withdraw(phone) {
      const amount = parseFloat(prompt(`üí∞ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô‡∏à‡∏≤‡∏Å ${phone}`));
      if (isNaN(amount) || amount <= 0) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");

      const ref = db.ref("customers/" + phone + "/balance");
      ref.transaction(current => {
        if (!current || current < amount) {
          alert("‚ùå ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠");
          return;
        }
        return current - amount;
      });
      alert(`üí∏ ‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å ${phone} ${amount.toFixed(2)} ‡∏ö‡∏≤‡∏ó‡πÅ‡∏•‡πâ‡∏ß`);
    }

    // ‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏°‡∏à‡∏≤‡∏Å Firebase
    const claimRef = db.ref("claims");
    const claimList = document.getElementById("claimList");

    claimRef.on("value", snapshot => {
      const data = snapshot.val() || {};
      claimList.innerHTML = "";
      for (const key in data) {
        const c = data[key];
        claimList.innerHTML += `
          <tr>
            <td>${c.name}</td>
            <td>${c.date}</td>
            <td>${c.phone}</td>
            <td>${c.bank}</td>
            <td>${c.account}</td>
            <td>${c.amount}</td>
            <td id="status-${key}" style="color:${c.status === "‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥" ? "green" : c.status === "‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò" ? "red" : "black"};">${c.status}</td>
            <td>
              <button class="btn-green" onclick="approveClaim('${key}')">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
              <button class="btn-red" onclick="rejectClaim('${key}')">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
            </td>
          </tr>`;
      }
    });

    function approveClaim(key) {
      db.ref("claims/" + key + "/status").set("‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥");
      document.getElementById(`status-${key}`).textContent = "‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥";
      document.getElementById(`status-${key}`).style.color = "green";
      alert("‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
    }

    function rejectClaim(key) {
      db.ref("claims/" + key + "/status").set("‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò");
      document.getElementById(`status-${key}`).textContent = "‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò";
      document.getElementById(`status-${key}`).style.color = "red";
      alert("‚ùå ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
    }

    // üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
    function logout() {
      if (confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
        sessionStorage.removeItem("isAdminLoggedIn");
        window.location.href = "admin-login.html";
      }
    }
  </script>
</body>
</html>
