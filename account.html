<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="https://flashexpress.com/favicon.ico" type="image/x-icon" />
  <title>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô | Flash Express</title>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600&display=swap" rel="stylesheet" />

  <style>
    body {
      font-family: "Prompt", sans-serif;
      background-color: #fffbea;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    header {
      background-color: #ffeb3b;
      padding: 14px 20px;
      font-weight: bold;
      font-size: 20px;
      position: sticky;
      top: 0;
      z-index: 10;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .container {
      padding: 20px;
      max-width: 450px;
      margin: auto;
    }

    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      margin: 20px auto;
      padding: 20px;
      text-align: left;
    }

    .card h3 { text-align:center;color:purple;margin-top:0; }
    .info p { margin:8px 0; }

    input {
      width:100%;
      padding:8px;
      border:1px solid #ccc;
      border-radius:6px;
      margin-top:3px;
      box-sizing:border-box;
    }

    button {
      display:block;
      margin:15px auto;
      font-size:16px;
      border:none;
      border-radius:8px;
      padding:10px 20px;
      cursor:pointer;
      transition:0.2s;
    }

    button.save-btn { background:#4caf50;color:white;width:80%;max-width:250px; }
    button#editBtn { background:#ffeb3b;color:#000;font-weight:bold;width:80%;max-width:250px; }
    button:hover { transform:scale(0.97); }

    a { display:block;margin-top:10px;color:purple;text-decoration:none;font-size:14px; }

    footer {
      position:fixed;
      bottom:0;
      left:0;
      width:100%;
      background:white;
      border-top:1px solid #ddd;
      display:flex;
      justify-content:space-around;
      padding:8px 0;
      font-size:12px;
      box-shadow:0 -2px 4px rgba(0,0,0,0.05);
    }
    footer a { text-align:center;text-decoration:none;color:#333; }

    @media (max-width:600px){
      .container{padding:10px;}
      .card{padding:15px;}
      input{font-size:15px;}
      button{font-size:15px;}
    }
  </style>
</head>
<body>

<header>üë§ ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</header>

<div class="container">
  <div class="card">
    <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
    <div class="info" id="infoBox"></div>
  </div>

  <div class="card" id="bankCard">
    <h3>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</h3>
    <div class="info" id="bankInfoBox"></div>
  </div>

  <button id="editBtn" onclick="enableEdit()">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
  <button id="saveBtn" class="save-btn" style="display:none;" onclick="saveData()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  <a href="index.html">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
</div>

<footer>
  <a href="index.html">üè†<br>‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
  <a href="news.html">üì∞<br>‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</a>
  <a href="transaction.html">üí∞<br>‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°</a>
  <a href="account.html" style="color: purple;"><b>üë§<br>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</b></a>
</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getDatabase, ref, get, update, set } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

  // üî• ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyALSOECmTwrVr0RQAp_b632HmxQ0sJvLMw",
    authDomain: "flash-claim-system.firebaseapp.com",
    databaseURL: "https://flash-claim-system-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "flash-claim-system",
    storageBucket: "flash-claim-system.firebasestorage.app",
    messagingSenderId: "369180040049",
    appId: "1:369180040049:web:6753f5e48a23bc6737b4d0",
    measurementId: "G-VLVBY60G3Q"
  };
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏´‡∏°‡∏î
  const params = new URLSearchParams(window.location.search);
  const phoneParam = params.get("phone");
  let activeCustomer = phoneParam || localStorage.getItem("active_customer");

  // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà
  if (!activeCustomer) {
    const inputPhone = prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà:");
    if (inputPhone && inputPhone.trim() !== "") {
      activeCustomer = inputPhone.trim();
      localStorage.setItem("active_customer", activeCustomer);
      await set(ref(db, "customers/" + activeCustomer), {
        phone: activeCustomer,
        createdAt: new Date().toLocaleString("th-TH"),
        wallet_balance: 0
      });
      alert("‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
    } else {
      alert("‚ùå ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô");
      window.location.href = "index.html";
    }
  }

  const infoBox = document.getElementById("infoBox");
  const bankBox = document.getElementById("bankInfoBox");
  const editBtn = document.getElementById("editBtn");
  const saveBtn = document.getElementById("saveBtn");
  let userData = {};
  let isAdminView = !!phoneParam;

  // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  async function loadData() {
    const snapshot = await get(ref(db, "customers/" + activeCustomer));
    if (snapshot.exists()) {
      userData = snapshot.val();
      renderData();
    } else {
      infoBox.innerHTML = "<p>‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</p>";
      editBtn.style.display = "none";
    }
    if (isAdminView) {
      editBtn.style.display = "none"; // ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏î‡∏π‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
      saveBtn.style.display = "none";
    }
  }

  // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  function renderData() {
    infoBox.innerHTML = `
      <p>‡∏ä‡∏∑‡πà‡∏≠: ${userData.name || "-"}</p>
      <p>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå: ${userData.phone || activeCustomer}</p>
      <p>‡∏≠‡∏µ‡πÄ‡∏°‡∏•: ${userData.email || "-"}</p>
      <p>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${(userData.wallet_balance || 0).toLocaleString("th-TH", { minimumFractionDigits: 2 })} ‡∏ø</p>
    `;
    bankBox.innerHTML = `
      <p>‡∏ä‡∏∑‡πà‡∏≠‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£: ${userData.bankName || "-"}</p>
      <p>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: ${userData.accountNumber || "-"}</p>
      <p>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: ${userData.accountOwner || "-"}</p>
    `;
  }

  // ‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
  function enableEdit() {
    if (isAdminView) return alert("üîí ‡πÇ‡∏´‡∏°‡∏î‡∏î‡∏π‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (Admin)");
    infoBox.innerHTML = `
      <p>‡∏ä‡∏∑‡πà‡∏≠: <input id="name" value="${userData.name || ""}"></p>
      <p>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå: <input id="phone" value="${activeCustomer}" disabled></p>
      <p>‡∏≠‡∏µ‡πÄ‡∏°‡∏•: <input id="email" value="${userData.email || ""}"></p>
    `;
    bankBox.innerHTML = `
      <p>‡∏ä‡∏∑‡πà‡∏≠‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£: <input id="bankName" value="${userData.bankName || ""}"></p>
      <p>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: <input id="accountNumber" value="${userData.accountNumber || ""}"></p>
      <p>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: <input id="accountOwner" value="${userData.accountOwner || ""}"></p>
    `;
    editBtn.style.display = "none";
    saveBtn.style.display = "block";
  }

  // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  async function saveData() {
    const updates = {
      name: document.getElementById("name").value.trim(),
      email: document.getElementById("email").value.trim(),
      bankName: document.getElementById("bankName").value.trim(),
      accountNumber: document.getElementById("accountNumber").value.trim(),
      accountOwner: document.getElementById("accountOwner").value.trim()
    };
    await update(ref(db, "customers/" + activeCustomer), updates);
    alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
    saveBtn.style.display = "none";
    editBtn.style.display = "block";
    loadData();
  }

  loadData();
</script>
</body>
</html>
